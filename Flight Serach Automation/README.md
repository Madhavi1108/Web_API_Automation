# Flight Price Tracker

This Python application tracks flight prices for specified destinations and sends notifications via WhatsApp for cheap flight deals.

## Project Description

The application automates the process of searching for flights and notifying the user of affordable options. It interacts with multiple APIs:

* **Sheety:** To manage destination data (city names and IATA codes) in a Google Sheet.
* **Amadeus:** To retrieve flight information, including prices, origin/destination codes, and dates.
* **Twilio:** To send WhatsApp notifications with flight details.

## Files Included

* `main.py`: The main script that orchestrates the flight search, data management, and notification processes.
* `data_manager.py`:  Handles communication with the Sheety API to get and update destination data in a Google Sheet.
* `flight_search.py`:  Uses the Amadeus API to search for flights and retrieve IATA codes for cities.
* `flight_data.py`:  Defines the `FlightData` class to store flight information and includes a function (`find_cheapest_flight`) to find the cheapest flight from the search results.
* `notification_manager.py`: Manages sending WhatsApp notifications using the Twilio API.

## Setup Instructions

1.  **Install Dependencies:**

    ```bash
    pip install requests python-dotenv twilio
    ```

2.  **Environment Variables:**

    * Create a `.env` file in the project directory.
    * Add the following environment variables to the `.env` file:

        ```
        SHEETY_PRICES_ENDPOINT="YOUR_SHEETY_PRICES_ENDPOINT" # The URL of your Sheety Google Sheet API
        SHEETY_USERNAME="YOUR_SHEETY_USERNAME"           # Your Sheety username
        SHEETY_PASSWORD="YOUR_SHEETY_PASSWORD"           # Your Sheety password
        AMADEUS_API_KEY="YOUR_AMADEUS_API_KEY"           # Your Amadeus API key
        AMADEUS_SECRET="YOUR_AMADEUS_SECRET"            # Your Amadeus API secret
        TWILIO_SID="YOUR_TWILIO_ACCOUNT_SID"          # Your Twilio Account SID
        TWILIO_AUTH_TOKEN="YOUR_TWILIO_AUTH_TOKEN"      # Your Twilio Auth Token
        TWILIO_WHATSAPP_NUMBER="YOUR_TWILIO_WHATSAPP_NUMBER" # Your Twilio WhatsApp number (e.g., +14155238886)
        TWILIO_VERIFIED_NUMBER="YOUR_VERIFIED_NUMBER"   # Your verified Twilio WhatsApp number to receive notifications
        ```

    * **Note:** Ensure you have accounts and API keys for Sheety, Amadeus, and Twilio.  You'll also need a Google Sheet set up to use with Sheety.

3.  **Google Sheet Setup:**

    * Create a Google Sheet with the following columns: `city` (string), `iataCode` (string, initially empty), `lowestPrice` (number),  and `id` (number, auto-generated by Sheety).
    * Publish the Google Sheet and obtain the Sheety API endpoint URL.  This URL will be used as the `SHEETY_PRICES_ENDPOINT`.
    * Enable read and write permissions for the sheet.

## Usage

1.  Run the `main.py` script:

    ```bash
    python main.py
    ```

2.  The script will:

    * Fetch destination data from the Google Sheet.
    * Use the Amadeus API to get the IATA codes for cities where they are missing in the sheet.
    * Update the Google Sheet with the IATA codes.
    * Search for the cheapest flights for each destination within a specified date range (tomorrow to 6 months from today).
    * Send a WhatsApp notification via Twilio with the cheapest flight details.

## Important Notes

* **Rate Limiting:** The script includes `time.sleep(2)` to help avoid exceeding API rate limits.  You may need to adjust this based on the API usage limits.
* **Error Handling:** The code includes basic error handling (e.g., for missing IATA codes), but you might want to add more robust error handling for production use.
* **Token Management:** The Amadeus API token is fetched every time the script runs.  For efficiency, you could implement token caching to reuse unexpired tokens.
* **Customization:** You can customize the origin city (`ORIGIN_CITY_IATA`), date range for flight searches, and notification messages in the `main.py` file.
```
